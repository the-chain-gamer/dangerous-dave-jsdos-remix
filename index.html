<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dangerous Dave (DOS)</title>

  <!-- js-dos v8 (official CDN) -->
  <link rel="stylesheet" href="https://v8.js-dos.com/latest/js-dos.css">
  <style>
    html, body, #dos { height: 100%; margin: 0; background: #000; }

    /* Keep the HUD low so it doesn't cover gameplay */
    .hud-left, .hud-right {
      position: fixed; z-index: 50; pointer-events: auto;
    }
    .hud-left  { left: 12px;  bottom: calc(12px + env(safe-area-inset-bottom)); }
    .hud-right { right: 12px; bottom: calc(12px + env(safe-area-inset-bottom)); display: flex; flex-direction: column; gap: 10px; }

    /* Keyboard-style D-pad: < v > on one row, ^ centered above v */
    .dpad-kb {
      display: grid; gap: 8px;
      grid-template-columns: 56px 56px 56px;
      grid-template-rows:    56px 56px;
    }
    .btn {
      min-width: 56px; min-height: 56px; border-radius: 12px;
      border: 1px solid #2f3a4a; background: #1f2937; color: #fff;
      font: 700 14px/1 system-ui, sans-serif; opacity: .92; cursor: pointer;
      touch-action: none; user-select: none;
    }
    .btn:active { opacity: 1; }

    /* grid placement */
    .up    { grid-column: 2; grid-row: 1; }
    .left  { grid-column: 1; grid-row: 2; }
    .down  { grid-column: 2; grid-row: 2; }
    .right { grid-column: 3; grid-row: 2; }

    .act { min-width: 72px; }
  </style>
</head>
<body>
  <div id="dos"></div>

  <!-- Controls (inside the game page so Remix rotation still applies) -->
  <div class="hud-left">
    <div class="dpad-kb">
      <button class="btn up"    id="k-up">▲</button>
      <button class="btn left"  id="k-left">◀</button>
      <button class="btn down"  id="k-down">▼</button>
      <button class="btn right" id="k-right">▶</button>
    </div>
  </div>

  <div class="hud-right">
    <button class="btn act" id="k-ctrl">CTRL</button>
    <button class="btn act" id="k-alt">ALT</button>
  </div>

  <script src="https://v8.js-dos.com/latest/js-dos.js"></script>
  <script>
    (function () {
      // Start js-dos v8 (no worker => no cross-origin Worker issues)
      let ci = null, backlog = [];
      const withCi = fn => ci ? fn(ci) : backlog.push(fn);

      Dos(document.getElementById("dos"), {
        url: "./bundleNEW.jsdos",      // <-- update if your bundle name differs
        autoStart: true,
        workerThread: false,
        onEvent: (ev, _ci) => {
          if (ev === "ci-ready") {
            ci = _ci;
            // Auto-start Dangerous Dave from the DOS prompt:
            // If your bundle already autoexecs dave.exe, you can remove these lines.
            ci.exec("DDAVE\\DAVE.EXE");   // or: ci.exec("CD DDAVE"); ci.exec("DAVE.EXE");

            backlog.forEach(f => f(ci));
            backlog = [];
          }
        }
      });

      // GLFW key codes used by js-dos
      const K = { LEFT:263, RIGHT:262, UP:265, DOWN:264, CTRL:341, ALT:342 };

      function bindKey(el, code) {
        const press   = e => { e.preventDefault(); withCi(c => c.sendKeyEvent(code, true));  };
        const release = e => { e.preventDefault(); withCi(c => c.sendKeyEvent(code, false)); };
        ["pointerdown","mousedown","touchstart"].forEach(t => el.addEventListener(t, press,   {passive:false}));
        ["pointerup","pointercancel","mouseup","mouseleave","touchend","touchcancel"]
          .forEach(t => el.addEventListener(t, release, {passive:false}));
      }

      // D-pad bindings
      bindKey(document.getElementById("k-left"),  K.LEFT);
      bindKey(document.getElementById("k-right"), K.RIGHT);
      bindKey(document.getElementById("k-up"),    K.UP);
      bindKey(document.getElementById("k-down"),  K.DOWN);

      // Actions (CTRL = jump, ALT = fire)
      bindKey(document.getElementById("k-ctrl"),  K.CTRL);
      bindKey(document.getElementById("k-alt"),   K.ALT);
    })();
  </script>
</body>
</html>